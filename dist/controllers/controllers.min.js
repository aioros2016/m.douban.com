angular.module('singlePage', ["ngRoute","mainMod","movieMod","bookMod","radioMod","teamMod"])
.config(function ($routeProvider){
	$routeProvider.when(
		'/main',{
			templateUrl: './views/main.html',
			controller: 'mainController'
		}
	).when(
		'/movie',{
			templateUrl: './views/movie.html',
			controller: 'movieController'
		}
	).when(
		'/book',{
			templateUrl: './views/book.html',
			controller: 'bookController'
		}
	).when(
		'/radio',{
			templateUrl: './views/radio.html',
			controller: 'radioController'
		}
	).when(
		'/team',{
			templateUrl: './views/team.html',
			controller: 'teamController'
		}
	).
	otherwise({
        redirectTo: '/main'
    });
}).controller('indexController', function($scope){
	$scope.showPop = true;
	$scope.iconSearch = {
		"background": "url(../img/search2.png) no-repeat 50%",
		"background-color": "#f3f3f3",
		"background-size": "auto 70%"
	};
	$scope.rnd = function(n, m){
		return parseInt(Math.random() * (m - n) + n);
	};
	$scope.rndColor = {
        "color" : "rgb("+ $scope.rnd(0, 255) +","+ $scope.rnd(0, 255) +","+ $scope.rnd(0, 255) +")"
    };
    $scope.quickMenu = document.querySelectorAll('.menu-box a');
    for(var i=0; i<$scope.quickMenu.length; i++){
    		$scope.r = $scope.rnd(0,255);
    		$scope.g = $scope.rnd(0,255);
    		$scope.b = $scope.rnd(0,255);
    		$scope.quickMenu[i].style.color = "rgb("+ $scope.r +","+ $scope.g +","+ $scope.b +")";
    };
}).directive('onFinishRender', function ($timeout) {
    return {
        restrict: 'A',
        link: function (scope, element, attr) {
            if (scope.$last === true) {
                $timeout(function () {
                    scope.$emit('ngRepeatFinished');
                });
            }
        }
    }
});
angular.module('mainMod', [])
.controller('mainController', function ($scope, $http){
	$scope.page = 1;
	$scope.pageLen = 3;
	$scope.arr = [];
	$scope.loadPage = function(){
		$scope.page++;
		$scope.getData($scope.page);
		console.log($scope.arr);
	};
	
	$scope.getData = function(page){
		$http.get('json/main'+ page +'.json').success(function(res){
			$scope.list = res.list;
			for(var json in $scope.list){
		        $scope.arr.push($scope.list[json]);
		    };
		    //console.log($scope.arr);
			
		}).error(function(){
			alert("载入失败");
		});
	}
	$scope.getData(1);
});
angular.module('movieMod', [])
.controller('movieController', function($scope, $http) {
	$http.get('json/movie1.json').success(function(res){
		$scope.json = res;
		$scope.$on('ngRepeatFinished', function(ngRepeatFinishedEvent) {
			$scope.swiper = new Swiper('.rank1', {
		        slidesPerView: 'auto',
		        freeMode: true,
		        observer: true,
		        observeParents: true,
		        resistanceRatio:0
			});
		    $scope.swiper2 = new Swiper('.rank2', {
		        slidesPerView: 'auto',
		        freeMode: true,
		        observer: true,
		        observeParents: true,
		        resistanceRatio:0
		    });
		    $scope.swiper3 = new Swiper('.rank3', {
		        slidesPerView: 'auto',
		        freeMode: true,
		        observer: true,
		        observeParents: true,
		        resistanceRatio:0
		    });
		    $scope.swiper4 = new Swiper('.find-movie', {
		        direction: 'horizontal',
		        slidesPerView: 'auto',
		        freeMode: true,
		        observer: true,
		        observeParents: true,
		        resistanceRatio:0
		    });
		});
		
	}).error(function(){
		alert("载入失败");
	});
});

angular.module('bookMod', [])
.controller('bookController', function ($scope, $http){
	$http.get('json/book1.json').success(function(res){
		$scope.json = res;
		
		$scope.$on('ngRepeatFinished', function(ngRepeatFinishedEvent) {
			$scope.swiper = new Swiper('.rank1', {
		        slidesPerView: 'auto',
		        freeMode: true,
		        observer: true,
		        observeParents: true,
		        resistanceRatio:0
			});
		    $scope.swiper2 = new Swiper('.rank2', {
		        slidesPerView: 'auto',
		        freeMode: true,
		        observer: true,
		        observeParents: true,
		        resistanceRatio:0
		    });
		    $scope.swiper3 = new Swiper('.rank3', {
		        slidesPerView: 'auto',
		        freeMode: true,
		        observer: true,
		        observeParents: true,
		        resistanceRatio:0
		    });
		    $scope.swiper4 = new Swiper('.find-book', {
		        direction: 'horizontal',
		        slidesPerView: 'auto',
		        freeMode: true,
		        observer: true,
		        observeParents: true,
		        resistanceRatio:0
		    });
		});
	}).error(function(){
		alert("载入失败");
	});
});
angular.module('radioMod', [])
.controller('radioController', function ($scope, $http){
	$http.get('json/radio1.json').success(function(res){
		$scope.list = res.radio1;
	}).error(function(){
		alert("载入失败");
	});
});
angular.module('teamMod', [])
.controller('teamController', function ($scope, $http){
	$http.get('json/team1.json').success(function(res){
		$scope.arr = res;
	}).error(function(){
		alert("载入失败");
	});
	$scope.getDateDiff = function(dateTimeStamp){
		var minute = 1000 * 60;
		var hour = minute * 60;
		var day = hour * 24;
		var halfamonth = day * 15;
		var month = day * 30;
		var now = new Date().getTime();
		var diffValue = now - dateTimeStamp;
		if(diffValue < 0){return;}
		var monthC =diffValue/month;
		var weekC =diffValue/(7*day);
		var dayC =diffValue/day;
		var hourC =diffValue/hour;
		var minC =diffValue/minute;
		if(monthC>=1){
			result="" + parseInt(monthC) + "月前更新：";
		}
		else if(weekC>=1){
			result="" + parseInt(weekC) + "周前更新：";
		}
		else if(dayC>=1){
			result=""+ parseInt(dayC) +"天前更新：";
		}
		else if(hourC>=1){
			result=""+ parseInt(hourC) +"小时前更新：";
		}
		else if(minC>=1){
			result=""+ parseInt(minC) +"分钟前更新：";
		}else
		result="刚刚更新：";
		return result;
	};
});